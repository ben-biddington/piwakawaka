<html>
<head>
  <!-- `npm run webpack.build` to create the following -->
  <script src="/dist/adapters.bundle.js"></script>
  <script src="/dist/hn-application.bundle.js"></script>

  <script language="javascript" defer>
    const log           = adapters.log;
    const topHackerNews = adapters.top;
    const core          = application.newHackerNewsApplication({ log });

    const get = (url, headers) => fetch(url).then(reply => reply.text());

    const urlParams = new URLSearchParams(window.location.search);

    const opts = { baseUrl: '/hn/api/', count: urlParams.get('count') || 5 };

    const render = result => {
      const container = document.getElementById("news");
      const list      = document.createElement("ol");

      result.map(newsItem => {
        const item      = document.createElement('li');
        item.setAttribute('style', 'padding:5px');
        item.setAttribute('class', 'newsItem');

        const link = document.createElement('a');

        link.innerHTML  = `${newsItem.title} (${newsItem.host})`;
        link.setAttribute('href', newsItem.url);
        link.setAttribute('style', 'display:block;padding-bottom:4px');
        item.appendChild(link);

        const save = document.createElement('a');

        save.innerHTML  = 'save';
        save.setAttribute('href', '#');
        item.appendChild(save);

        list.appendChild(item);
      });

      container.appendChild(list);
    }

    console.time('time-to-get');

    topHackerNews({ get, log: console.log }, opts).
      then(args   => { console.timeEnd('time-to-get'); return args}).
      catch(e     => { throw e; }).
      then(result => render(result, opts));

    const showStatus = (m) => {
      const status = document.querySelector("#status");
      
      if (status) { 
        status.innerHTML = m;
      }
    }

    const clearStatus = () => {
      const status = document.querySelector("#status");
      status.innerHTML = '';
    }
  </script>
</head>

<body>
  <h1 id="title">News</h1>
  <div id="status"></div>
  <div id="news">
    
  </div>
</body>
</html>